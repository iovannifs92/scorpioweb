<!DOCTYPE html>
<html>
<head>
    @*Fullcallendar*@
    <link href='~/fullcalendar/lib/main.css' rel='stylesheet' />
    <script src='~/fullcalendar/lib/main.js'></script>
    <script src='~/fullcalendar/lib/locales/es-us.js'></script>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>

    <link rel="icon" type="image/png" href="~/images/scorpio_mini.png" />
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.css" />
    <link rel="stylesheet" href="~/css/site.css" />
    <link rel="stylesheet" href="~/css/font-awesome.min.css">
    <link rel="stylesheet" href="~/css/bootstrap.min.css">
    <link rel="stylesheet" href="~/css/main.css">
    <link rel="stylesheet" href="~/css/bootstraplocal.css"
          asp-fallback-href="~/lib/bootstrap/dist/css/bootstrap.min.css"
          asp-fallback-test-class="sr-only" asp-fallback-test-property="position" asp-fallback-test-value="absolute" />
    <link rel="stylesheet" href="~/css/site.min.css" asp-append-version="true" />

    @*PDF Visualizador*@
    <link href="https://cdn.syncfusion.com/ej2/17.2.28/material.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.syncfusion.com/ej2/17.2.28/dist/ej2.min.js" type="text/javascript"></script>

    @*Main jQuery*@
    <script src="~/js/jquery-1.11.1.min.js"></script>
    @*Contact form validation*@
    <script src="~/js/jquerylocal332.js"></script>
    @* Necesario para los modales en el servidor *@
    @*<script src="~/js/jquery-1.11.1.min.js"></script>*@
    <script src="~/js/jquerylocalvalidate.js"></script>
</head>
<body>
    <nav class="navbar navbar-inverse navbar-fixed-top" , id="header">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>



                <a asp-area="" asp-controller="Home" asp-action="Index" class="navbar-brand" style="padding: 15px 15px;">SCORPIO</a>
            </div>
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    @if (User.IsInRole("Asistentes"))
                    {
                        <li><a asp-area="" asp-controller="Personas" asp-action="MenuMCSCP">MC y SCP</a></li>
                    }
                    @if (User.IsInRole("Masteradmin") || User.IsInRole("Operativo") || User.IsInRole("SupervisorMCSCP") || User.IsInRole("AdminMCSCP") || User.IsInRole("AuxiliarMCSCP") || User.IsInRole("Oficialia"))
                    {
                        <li><a asp-area="" asp-controller="Personas" asp-action="Create">Entrevista</a></li>
                        <li><a asp-area="" asp-controller="Personas" asp-action="MenuMCSCP">MC y SCP</a></li>

                    }
                    @if (User.IsInRole("Masteradmin") || User.IsInRole("Operativo") || User.IsInRole("SupervisorMCSCP") || User.IsInRole("AdminMCSCP") || User.IsInRole("AuxiliarMCSCP") || User.IsInRole("Asistentes"))
                    {
                        <li><a asp-area="" asp-controller="ServiciosPreviosJuicio" asp-action="Index">Servicios Previos</a></li>
                    }
                    @if (User.IsInRole("Masteradmin") || User.IsInRole("Archivo") || User.IsInRole("AdminMCSCP") || User.IsInRole("SupervisorMCSCP") || User.IsInRole("Operativo"))
                    {
                        <li><a asp-area="" asp-controller="Prisionespreventivas" asp-action="Index">Prisiones Preventivas</a></li>
                    }                    
                    @if (User.IsInRole("Masteradmin") || User.IsInRole("SupervisorMCSCP") || User.IsInRole("AdminMCSCP") || User.IsInRole("Oficialia") || User.IsInRole("Coordinador"))
                    {
                        <li><a asp-area="" asp-controller="Oficialia" asp-action="Index">Oficialia</a></li>
@*                        <li><a asp-area="" asp-controller="Archivo" asp-action="ArchivoMenu">Archivo</a></li>
*@                    }
                    @if (User.IsInRole("Masteradmin"))
                    {
                        <li><a asp-area="" asp-controller="Administration" asp-action="MenuAdmin">Administracion</a></li>
                    }

                </ul>

                @await Html.PartialAsync("_LoginPartial")

            </div>
        </div>
    </nav>
    @if (User.Identity.IsAuthenticated)
    {
        <div id="myModal" class="modal fade" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="text-right">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">x</button>
                    </div>
                    <div class="modal-header float-center">
                        <h3 id="modal_body"></h3>
                    </div>
                    <div class="modal-body">
                        <div>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre</th>
                                        <th>Area a la que pertenece</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="tblBusqueda">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary fa fa-close" data-dismiss="modal">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>

    }

    <div class="container body-content">
        @RenderBody()

        <hr />
        <footer>
            <div class="col-md-2" style="padding-left: 0px;  padding-right: 0px; width: 150px; float:left;">
                <img src="~/images/logoFooter.png" class="img-responsive" style="float:left;">
                @*<p>&copy; 2019 - SCORPIO</p>*@
            </div>

            @if (User.Identity.IsAuthenticated)
            {   
                <div class="col-1 col-md-1" style="float:right">
                    <button type="submit" id="buscar" class="form-control" name="buscar" onclick="Buscar()"><i class="fa fa-search"></i></button>
                </div>
                <div class="col-3 col-md-3" style="float:right">
                    <input type="text" class="form-control" id="Nombre" name="Nombre" onkeypress="return soloLetras(event)" placeholder="Nombre...">
                </div>
                <div class="col-3 col-md-3" style="float:right">
                    <input type="text" class="form-control" id="Materno" name="Materno" onkeypress="return soloLetras(event)" placeholder="Materno..." >
                </div>
                <div class="col-3 col-md-3" style="float:right">
                    <input type="text" class="form-control" id="Paterno" name="Paterno" onkeypress="return soloLetras(event)" placeholder="Paterno...">
                </div>

               
            }
        </footer>
    </div>


    <script src="~/css/bootstraplocal.css"
            asp-fallback-src="~/lib/bootstrap/dist/js/bootstrap.min.js"
            asp-fallback-test="window.jQuery && window.jQuery.fn && window.jQuery.fn.modal"
            crossorigin="anonymous">
    </script>
    <script src="~/js/site.min.js" asp-append-version="true"></script>

    <div class="modal fade" id="form-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true" style="overflow-y: scroll; background-color: rgba(0, 0, 0, 0.5)" data-backdrop="false" data-keyboard="false">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header" style="background-color:#0078A7;">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <i class="fa fa-close"></i>
                    </button>
                    <h5 class="modal-title" style="font-size: 30px; color:#fff;">Añadir Nueva Fracción</h5>
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-close"></i>Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    @RenderSection("Scripts", required: false)

    <a onclick="topFunction()" id="back-top"><i class="fa fa-angle-up fa-3x" id="fangle" name="fangle"></i></a>
    <ej-script-manager></ej-script-manager>
    <!-- Syncfusion Essential JS 2 ScriptManager -->
    <ejs-scripts></ejs-scripts>
</body>
</html>


<script>
    function Buscar() {
        var paterno = document.getElementById("Paterno").value.toUpperCase();
        var materno = document.getElementById("Materno").value.toUpperCase();
        var nombre = document.getElementById("Nombre").value.toUpperCase();

        if (paterno == "" || (paterno == "" && nombre == "")) {
            alert("Para realizar cualquier búsqueda colocar el apellido paterno");
            return false;
        }else if(materno == "" && nombre == ""){
            alert("Coloque apellido materno y/o nombre para continuar con la búsqueda");
            return false;
        }

        $.ajax({
            type: "POST",
            dataType: "json",
            url: "/Personas/buscadorGeneral",
            traditional: true,
            data: {
                var_paterno: paterno,
                var_materno: materno,
                var_nombre: nombre,
            },
            success: function(response) {
                $('#tblBusqueda').html('');
                var row = '';
                if (response.busqueda.length == 0) {
                    alert("No se encontro ningún registro que coincida")
                    return;
                }

                for (let i = 0; i < response.busqueda.length; i++) {
                    row = row
                        + "<tr>"
                        + "<td>" + response.busqueda[i].id + "</td>"
                        + "<td>" + response.busqueda[i].paterno+ " " + response.busqueda[i].materno +" "+ response.busqueda[i].nombre + "</td>"
                        + "<td>" + response.busqueda[i].tabla + "</td>"
                    row = row + "<td>";
                    switch (response.busqueda[i].tabla) {
                        case 'MC Y SCP':
                            row = row
                                + "<div class=\"col-md-3\"><a  href=/Personas/Procesos/" + response.busqueda[i].id + "  style = 'margin-top: 10px; margin-left:5px; margin-rigth:5px;' class='btn btn-info' > <i class='fa fa-eye'></i> Ir</a ></div>";
                            break;
                        case 'ARCHIVO':
                            row = row
                                + "<div class=\"col-md-3\"><a  href=/Archivo style = 'margin-top: 10px; margin-left:5px; margin-rigth:5px;' class='btn btn-info' > <i class='fa fa-eye'></i> Ir</a ></div>";
                            break;
                        case 'SERVICIOS PREVIOS AL JUICIO':
                            row = row
                                + "<div class=\"col-md-3\"><a  href=/ServiciosPreviosJuicio style = 'margin-top: 10px; margin-left:5px; margin-rigth:5px;' class='btn btn-info' > <i class='fa fa-eye'></i> Ir</a ></div>";
                            break;
                        case 'PRISION PREVENTIVA':
                            row = row
                                + "<div class=\"col-md-3\"><a  href=/Prisionespreventivas style = 'margin-top: 10px; margin-left:5px; margin-rigth:5px;' class='btn btn-info' > <i class='fa fa-eye'></i> Ir</a ></div>";
                            break;
                        case 'OFICIALIA':
                            row = row
                                + "PENDIENTE";
                            break;
                    }
                    row = row + "</td>";
                    row = row + "</tr>";
                };
                if (row != '') {
                    $('#tblBusqueda').append(row);
                }
                $("#myModal").modal();
                var str = "Resultados de  ";
                $("#modal_body").html(str);
            },
            error: function(response) {
                //alert("Hubo un error, no se pudieron guardar los datos, contacte con el administrador del sistema");
                //location.reload();
            }
        });
    };


    function soloLetras(e) {
        var key = e.keyCode || e.which,
            tecla = String.fromCharCode(key).toLowerCase(),
            letras = " áéíóúabcdefghijklmnñopqrstuvwxyz",
            especiales = [8, 37, 39, 46],
            tecla_especial = false;

        for (var i in especiales) {
            if (key == especiales[i]) {
                tecla_especial = true;
                break;
            }
        }

        if (letras.indexOf(tecla) == -1 && !tecla_especial) {
            return false;
        }
    }
</script>