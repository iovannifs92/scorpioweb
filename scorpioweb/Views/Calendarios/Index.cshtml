@model IEnumerable<scorpioweb.Models.Calendario>

@{
    ViewData["Title"] = "Calendario";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script>

    showModal = (url, title, id) => {
        $.ajax({
            type: "GET",
            url: url + "?id=" + id,
            success: function (res) {
                $("#form-modal .modal-body").html(res);
                $("#form-modal .modal-title").html(title);
                $("#form-modal").modal('show');
            },
            error: function (res) {

            }
        })
    }

    $(function() {
        getEventosCalendario();
    });

    function getEventosCalendario(){
        $.get('/Calendarios/getCalendarTasks')
            .done(function (data){                
                const date = new Date();
                var calendarEl = document.getElementById('calendar');
                var events = [];

                for(var i = 0; i < data.length; i++){
                    const idcalendario=data[i].Idcalendario;
                    const mensaje=data[i].Mensaje;
                    const fecha = data[i].FechaEvento;
                    const color=data[i].Color;
                    let url="";
                    if(data[i].Idcalendario == 0){
                        url=new URL('http://10.6.60.190/Supervisiones/Supervision/'+data[i].IdSupervision);
                    }
                    events.push({
                        'id': idcalendario,
                        'title': mensaje,
                        'start': fecha,
                        'color':color,
                        'url': url,
                    });  
                }
                console.log(events);


                var calendar = new FullCalendar.Calendar(calendarEl, {
                    locale: 'es',
                    headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
                    },
                    eventClick:  function(info, jsEvent, view) {
                        showModal('@Url.Action("Edit","Calendarios",null,Context.Request.Scheme)', 'Editar Evento', info.event.id);
                    },
                    initialDate: date,
                    navLinks: true, 
                    businessHours: true,
                    editable: false,
                    selectable: true,
                    dayMaxEvents: true,
                    events: events
                });

                calendar.render();
                });
    }
</script>

<style>

  body {
    margin: 40px 10px;
    padding: 0;
    font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
    font-size: 14px;
  }

  #calendar {
    max-width: 80%;
    margin: 0 auto;
    padding-top: 2%;
    padding-bottom: 2%;
  }

</style>


<div id='calendar'></div>
