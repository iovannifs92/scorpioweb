@{
    ViewData["Title"] = "RegistroConfirmation";
}



@if (ViewBag.nombreRegistrado != null)
{

    <h2 class="alert alert-success" role="alert" style="text-align:center ">
        Registro exitoso de:<br />
        @ViewBag.nombreRegistrado<br />
        @ViewBag.idRegistrado<br />
        <a href="#" onclick="AlertCanalizacion('@ViewBag.idRegistrado','@ViewBag.NombreTabla')"><u>Canalizar algun servicio post penal</u></a>
    </h2>

}
else
{
    <h2 style="text-align:center" class="alert alert-danger" role="alert">
        No se registro.<br>
        Comuniquese con su administrador.
    </h2>
}
<a asp-controller="@ViewBag.ControllerName" asp-action="Index" class="btn btn-link">
    Regresar al listado completo
</a>

<script> 
    //function hola(idregistrado,nombretabla){
    //    let datos = [idregistrado, nombretabla ];
    //    console.log(datos);
    //}
    // function AlertCanalizacion(IdPersona, tabla) {
    //    // Swal.fire({
    //    //     title: "¿Deseas iniciar canalización de la persona?",
    //    //     icon: "question",
    //    //     showCancelButton: true,
    //    //     confirmButtonColor: "#3085d6",
    //    //     cancelButtonColor: "#d33",
    //    //     confirmButtonText: "Si"
    //    // }).then((result) => {
    //    //     if (result.isConfirmed) {
    //    //         var datos = {
    //    //             IdTabla: IdPersona,
    //    //             Tabla: tabla,
    //    //             Lugar: "DGEPMS",
    //    //             Estado: "EN ESPERA"
    //    //         };
    //    //         AjaxCrearReinsercion(datos);
    //    //     }
    //    // });
    //       Swal.fire({
    //         title: `Proceso de canalización`,
    //         html: `
    //           <p><strong>Area:</strong> ${tabla ?? ''}</p>
    //           <p><strong>Nombre:</strong> @ViewBag.nombreRegistrado  </p>
    //           <p><strong>Teléfono:</strong> ${"@ViewBag.celular" ?? ''}</p>
    //           <p><strong>Delito:</strong> <input asp-for="delito"/></p>
    //           <p><strong>Causa Penal:</strong> <input asp-for="causapenal"/></p>
    //         `,
    //         imageUrl:" data.foto",
    //         imageHeight: 300,
    //         imageAlt: "Foto de la persona"
    //       });
    // }
    function AlertCanalizacion(IdPersona, tabla) {
           Swal.fire({
               title: "¿Deseas iniciar canalización de la persona?",
               icon: "question",
               showCancelButton: true,
               confirmButtonColor: "#3085d6",
               cancelButtonColor: "#d33",
               confirmButtonText: "Si"
           }).then((result) => {
               if (result.isConfirmed) {
                   var datos = {
                       IdTabla: IdPersona,
                       Tabla: tabla,
                       Lugar: "DGEPMS",
                       Estado: "EN ESPERA"
                   };
                   AjaxCrearReinsercion(datos);
               }
           });
          Swal.fire({
            title: `Proceso de canalización`,
            html: `
              <p><strong>Area:</strong> ${tabla ?? ''}</p>
              <p><strong>Nombre:</strong> @ViewBag.nombreRegistrado  </p>
              <p><strong>Teléfono:</strong> ${"@ViewBag.celular" ?? ''}</p>
              <p><strong>Delito:</strong> <input asp-for="delito"/></p>
              <p><strong>Causa Penal:</strong> <input asp-for="causapenal"/></p>
            `,
            imageUrl:" data.foto",
            imageHeight: 300,
            imageAlt: "Foto de la persona"
          });
    }


    function AjaxCrearReinsercion(datos) {
       $.ajax({
           type: "POST",
           dataType: "json",
           async: true,
           url: "/Reinsercion/CrearReinsercionPorSupervisor",
           traditional: true,
           contentType: 'application/json; charset=utf-8',
           data: JSON.stringify(datos),
           success: function (response) {
               console.log('Respuesta del controlador:', response);
               sweetAlertAjax(true, response.responseText);

               setTimeout(function () {
                   window.location.href = response.viewUrl;
               }, 1700);
           },
           error: function (xhr, status, error) {
               console.error('Error al enviar datos al controlador:', status, error);
               sweetAlertAjax(false, error);
           }
       });
    }

    function sweetAlertAjax(isSuccess, respuestaAjax, callback) {
       if (isSuccess) {
           Swal.fire({
               icon: "success",
               title: "Persona en tramites de canalizacion, por favor espera la antencion!",
               text: respuestaAjax,
               showConfirmButton: false,
               timer: 1500
           });
       }
       else {
           Swal.fire({
               icon: "error",
               title: "la persona no ha sido canalizada!",
               text: "Comuniquese con el administrador del sistema, Error: " + respuestaAjax
           });
       }
    }
</script>